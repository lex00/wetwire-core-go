name: aws_gitlab_deployment
description: AWS infrastructure with GitLab CI/CD pipeline for deployment

prompts:
  default: prompt.md
  variants:
    minimal: prompts/minimal.md

domains:
  - name: aws
    cli: wetwire-aws
    mcp_tools:
      lint: wetwire_lint
      build: wetwire_build
      validate: wetwire_validate
    outputs:
      - cfn-templates/*.json
      - cfn-templates/*.yaml

  - name: gitlab
    cli: wetwire-gitlab
    mcp_tools:
      lint: wetwire_lint
      build: wetwire_build
    depends_on:
      - aws
    outputs:
      - .gitlab-ci.yml
      - deploy/*.yaml

cross_domain:
  - from: aws
    to: gitlab
    type: artifact_reference
    validation:
      required_refs:
        - "${aws.vpc.outputs.vpc_id}"
        - "${aws.eks.outputs.cluster_name}"
        - "${aws.rds.outputs.endpoint}"

validation:
  aws:
    stacks:
      min: 3
      max: 10
    resources:
      min: 5
  gitlab:
    pipelines:
      min: 1
